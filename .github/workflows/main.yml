name: Main

on:
  push:
    paths-ignore:
      - '**/*.md'
      - '**/*.code-*'
      - '.vscode/**'
      - '.devcontainer.json'
  workflow_dispatch:

jobs:
  test:
    uses: ocadotechnology/codeforlife-workspace/.github/workflows/test-javascript-code.yaml@main
    secrets: inherit
    with:
      # Cannot be set with an env var. Value must match in the release job.
      node-version: 18

  release:
    needs: [test]
    uses: ocadotechnology/codeforlife-workspace/.github/workflows/release.yaml@main
    secrets: inherit
