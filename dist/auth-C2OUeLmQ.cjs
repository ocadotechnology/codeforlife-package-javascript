"use strict";const y=require("react/jsx-runtime"),C=require("yup"),l=require("react"),w=require("js-cookie"),m=require("react-router"),z=require("react-redux");require("@reduxjs/toolkit/query/react");const V=require("./settings/index.cjs.js"),B=require("./session-CE2U7oL1.cjs"),q=require("./utils/auth.cjs.js");require("@mui/material");const G=require("./utils/general.cjs.js");require("@mui/icons-material");require("./schemas-hIW9-H6-.cjs");require("./urls-2gheISSO.cjs");const k=require("./utils/schema.cjs.js");require("./palette-BnIdHKDE.cjs");function H(e){const r=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const t in e)if(t!=="default"){const s=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,s.get?s:{enumerable:!0,get:()=>e[t]})}}return r.default=e,Object.freeze(r)}const T=H(C);function v(){const e=m.useNavigate(),r=P();return(t,s=void 0)=>{if(typeof t=="number")e(t);else{const{next:o=!0,...i}=s||{};e(o&&"next"in r?r.next:t,i)}}}function E(){return m.useLocation()}function P(e,r){const t=Object.fromEntries(m.useSearchParams()[0].entries());return e?k.tryValidateSync(t,C.object(e),r):t}function J(e,r){const t=m.useParams();return e?k.tryValidateSync(t,C.object(e),r):t}function Q({shape:e,children:r,onValidationError:t,onValidationSuccess:s=()=>{},validateOptions:o}){const i=J(e,o),a=v();return l.useEffect(()=>{i?s(i):t(a)},[]),i?r(i):y.jsx(y.Fragment,{})}function S(e=V.SESSION_METADATA_COOKIE_NAME){return z.useSelector(B.selectIsLoggedIn)?JSON.parse(w.get(e)):void 0}S.predefine=(e=V.SESSION_METADATA_COOKIE_NAME)=>()=>S(e);function W(e,r={}){const{userType:t,next:s=!0}=r,{pathname:o}=E(),i=v(),a=S(),c=t&&(!a||a.user_type!==t);return l.useEffect(()=>{c&&i({pathname:"/login"+{teacher:"/teacher",student:"/student",indy:"/independent"}[t],search:s?m.createSearchParams({next:o}).toString():void 0})},[i,c,t,s,o]),c?y.jsx(y.Fragment,{}):typeof e=="function"?e(a):e}function F(e,r=32,t="state"){const s=q.makeOAuth2StorageKey(e,t),o=sessionStorage.getItem(s),[i,a]=l.useState();l.useEffect(()=>{let u;o&&o.length===r?u=o:(u=G.generateSecureRandomString(r),sessionStorage.setItem(s,u)),a(u)},[s,o,r]);const c=l.useCallback(()=>{sessionStorage.removeItem(s),a(void 0)},[s]);return[i,c]}function D(e,r=128,t="codeChallenge"){const s=q.makeOAuth2StorageKey(e,t),o=sessionStorage.getItem(s),[i,a]=l.useState();l.useEffect(()=>{let u;if(o){const n=JSON.parse(o);typeof n=="object"&&n&&"verifier"in n&&typeof n.verifier=="string"&&n.verifier.length===r&&"challenge"in n&&typeof n.challenge=="string"&&"method"in n&&n.method==="S256"&&(u={verifier:n.verifier,challenge:n.challenge,method:n.method})}u?a(u):q.generateOAuth2CodeChallenge(r).then(n=>{sessionStorage.setItem(s,JSON.stringify(n)),a(n)}).catch(n=>{n&&console.error(n)})},[s,o,r]);const c=l.useCallback(()=>{sessionStorage.removeItem(s),a(void 0)},[s]);return[i,c]}function X({provider:e,authUri:r,clientId:t,redirectUri:s,scope:o,responseType:i="code",accessType:a="offline",prompt:c,useSessionMetadata:u,useLoginMutation:n,onCreateSession:I,onRetrieveSession:b}){const[h,M]=F(e),[{verifier:_,challenge:j,method:x}={},N]=D(e),[R,{originalArgs:f={},isLoading:L,isError:K}]=n(),O=u(),p=v(),d=P({code:T.string(),state:T.string()})||{},g=E().state||{};if(l.useEffect(()=>{d.code&&d.state&&p(".",{replace:!0,next:!1,state:{code:d.code,state:d.state}})},[d.code,d.state,p]),l.useEffect(()=>{O?b(O):h&&_&&g.code&&g.state===h&&(f.code!==g.code||f.code_verifier!==_||f.redirect_uri!==s||!K)&&!L&&R({code:g.code,code_verifier:_,redirect_uri:s}).unwrap().then(I).catch(()=>{p(".",{replace:!0,state:{notifications:[{props:{error:!0,children:"Failed to login. Please try again."}}]}})}).finally(()=>{M(),N()})},[p,s,h,g.state,M,_,g.code,N,R,L,K,f.code,f.code_verifier,f.redirect_uri,O,I,b]),h&&j&&x){const A={client_id:t,redirect_uri:s,scope:o,response_type:i,access_type:a,state:h,code_challenge:j,code_challenge_method:x};return c&&(A.prompt=c),[r+"?"+new URLSearchParams(A).toString(),A]}return[]}const Y=e=>X("useSessionMetadata"in e?e:{...e,useSessionMetadata:S});exports.useLocation=E;exports.useNavigate=v;exports.useOAuth2=Y;exports.useOAuth2CodeChallenge=D;exports.useOAuth2State=F;exports.useParams=J;exports.useParamsRequired=Q;exports.useSearchParams=P;exports.useSession=W;exports.useSessionMetadata=S;
//# sourceMappingURL=auth-C2OUeLmQ.cjs.map
