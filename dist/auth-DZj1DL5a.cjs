"use strict";const E=require("./jsx-runtime-CeSfJrVB.cjs"),C=require("yup"),l=require("react"),X=require("js-cookie"),p=require("react-router-dom"),Y=require("react-redux");require("@reduxjs/toolkit/query/react");const J=require("./settings/index.cjs.js"),Z=require("./session-CE2U7oL1.cjs"),x=require("./auth-CN0mUgZr.cjs"),$=require("@mui/material"),U=require("./general-ByvaleXK.cjs");require("@mui/icons-material");const w=require("./schemas-BykhozBX.cjs");require("./urls-B4eMOtC-.cjs");function ee(e){const r=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const t in e)if(t!=="default"){const s=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,s.get?s:{enumerable:!0,get:()=>e[t]})}}return r.default=e,Object.freeze(r)}const V=ee(C),z={500:"#E0004D",400:"#EE0857",300:"#FA1664"},B={500:"#F6BE00"},G={500:"#00A3E0"},{palette:{augmentColor:m}}=$.createTheme(),k={main:z[500],contrastText:"#fff"},F={main:G[500],contrastText:"#fff"},D={main:B[500],contrastText:"#000"},te={primary:k,teacher:m({color:k}),secondary:D,indy:m({color:D}),tertiary:m({color:F}),student:m({color:F}),white:m({color:{main:"#fff"}}),black:m({color:{main:"#000"}}),info:{main:"#f1ecec"},error:{main:"#d50000"}};function A(){const e=p.useNavigate(),r=P();return(t,s=void 0)=>{if(typeof t=="number")e(t);else{const{next:o=!0,...c}=s||{};e(o&&"next"in r?r.next:t,c)}}}function q(){return p.useLocation()}function P(e,r){const t=Object.fromEntries(p.useSearchParams()[0].entries());return e?w.tryValidateSync(t,C.object(e),r):t}function H(e,r){const t=p.useParams();return e?w.tryValidateSync(t,C.object(e),r):t}function se({shape:e,children:r,onValidationError:t,onValidationSuccess:s=()=>{},validateOptions:o}){const c=H(e,o),a=A();return l.useEffect(()=>{c?s(c):t(a)},[]),c?r(c):E.jsxRuntimeExports.jsx(E.jsxRuntimeExports.Fragment,{})}function S(e=J.SESSION_METADATA_COOKIE_NAME){return Y.useSelector(Z.selectIsLoggedIn)?JSON.parse(X.get(e)):void 0}S.predefine=(e=J.SESSION_METADATA_COOKIE_NAME)=>()=>S(e);function re(e,r={}){const{userType:t,next:s=!0}=r,{pathname:o}=q(),c=A(),a=S(),i=t&&(!a||a.user_type!==t);return l.useEffect(()=>{i&&c({pathname:"/login"+{teacher:"/teacher",student:"/student",indy:"/independent"}[t],search:s?p.createSearchParams({next:o}).toString():void 0})},[c,i,t,s,o]),i?E.jsxRuntimeExports.jsx(E.jsxRuntimeExports.Fragment,{}):typeof e=="function"?e(a):e}function Q(e,r=32,t="state"){const s=x.makeOAuth2StorageKey(e,t),o=sessionStorage.getItem(s),[c,a]=l.useState();l.useEffect(()=>{let u;o&&o.length===r?u=o:(u=U.generateSecureRandomString(r),sessionStorage.setItem(s,u)),a(u)},[s,o,r]);const i=l.useCallback(()=>{sessionStorage.removeItem(s),a(void 0)},[s]);return[c,i]}function W(e,r=128,t="codeChallenge"){const s=x.makeOAuth2StorageKey(e,t),o=sessionStorage.getItem(s),[c,a]=l.useState();l.useEffect(()=>{let u;if(o){const n=JSON.parse(o);typeof n=="object"&&n&&"verifier"in n&&typeof n.verifier=="string"&&n.verifier.length===r&&"challenge"in n&&typeof n.challenge=="string"&&"method"in n&&n.method==="S256"&&(u={verifier:n.verifier,challenge:n.challenge,method:n.method})}u?a(u):x.generateOAuth2CodeChallenge(r).then(n=>{sessionStorage.setItem(s,JSON.stringify(n)),a(n)}).catch(n=>{n&&console.error(n)})},[s,o,r]);const i=l.useCallback(()=>{sessionStorage.removeItem(s),a(void 0)},[s]);return[c,i]}function ne({provider:e,authUri:r,clientId:t,redirectUri:s,scope:o,responseType:c="code",accessType:a="offline",prompt:i,useSessionMetadata:u,useLoginMutation:n,onCreateSession:j,onRetrieveSession:I}){const[h,b]=Q(e),[{verifier:y,challenge:M,method:R}={},N]=W(e),[T,{originalArgs:f={},isLoading:L,isError:K}]=n(),O=u(),_=A(),d=P({code:V.string(),state:V.string()})||{},g=q().state||{};if(l.useEffect(()=>{d.code&&d.state&&_(".",{replace:!0,next:!1,state:{code:d.code,state:d.state}})},[d.code,d.state,_]),l.useEffect(()=>{O?I(O):h&&y&&g.code&&g.state===h&&(f.code!==g.code||f.code_verifier!==y||f.redirect_uri!==s||!K)&&!L&&T({code:g.code,code_verifier:y,redirect_uri:s}).unwrap().then(j).catch(()=>{_(".",{replace:!0,state:{notifications:[{props:{error:!0,children:"Failed to login. Please try again."}}]}})}).finally(()=>{b(),N()})},[_,s,h,g.state,b,y,g.code,N,T,L,K,f.code,f.code_verifier,f.redirect_uri,O,j,I]),h&&M&&R){const v={client_id:t,redirect_uri:s,scope:o,response_type:c,access_type:a,state:h,code_challenge:M,code_challenge_method:R};return i&&(v.prompt=i),[r+"?"+new URLSearchParams(v).toString(),v]}return[]}const oe=e=>ne("useSessionMetadata"in e?e:{...e,useSessionMetadata:S});exports.palette=te;exports.primary=z;exports.secondary=B;exports.tertiary=G;exports.useLocation=q;exports.useNavigate=A;exports.useOAuth2=oe;exports.useOAuth2CodeChallenge=W;exports.useOAuth2State=Q;exports.useParams=H;exports.useParamsRequired=se;exports.useSearchParams=P;exports.useSession=re;exports.useSessionMetadata=S;
//# sourceMappingURL=auth-DZj1DL5a.cjs.map
