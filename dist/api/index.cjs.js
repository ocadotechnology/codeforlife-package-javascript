"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const Q=require("../rtk-query.modern-PBCErCqb.cjs"),x=require("@reduxjs/toolkit"),T=require("react-redux"),n=require("react"),re=require("../settings/index.cjs.js"),ie=require("../session-CacrgFSv.cjs"),B=require("../utils/auth.cjs.js"),ue=require("../api-CnMfjRk3.cjs"),ce=require("../schemas-BZbJpkD5.cjs"),ae=require("../urls-MaVXL_C2.cjs");function z(e){return e.replace(e[0],e[0].toUpperCase())}function fe(e){let d=0;for(const g in e)d++;return d}function de(e){return e.type==="query"}function le(e){return e.type==="mutation"}function te(e){return e.type==="infinitequery"}function H(e,...d){return Object.assign(e,...d)}var Y=Symbol();function Z(e){const d=n.useRef(e),g=n.useMemo(()=>Q.copyWithStructuralSharing(d.current,e),[e]);return n.useEffect(()=>{d.current!==g&&(d.current=g)},[g]),g}function $(e){const d=n.useRef(e);return n.useEffect(()=>{T.shallowEqual(d.current,e)||(d.current=e)},[e]),T.shallowEqual(d.current,e)?d.current:e}var pe=()=>typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",be=pe(),ye=()=>typeof navigator<"u"&&navigator.product==="ReactNative",ge=ye(),he=()=>be||ge?n.useLayoutEffect:n.useEffect,me=he(),ee=e=>e.isUninitialized?{...e,isUninitialized:!1,isFetching:!0,isLoading:e.data===void 0,status:Q.QueryStatus.pending}:e;function J(e,...d){const g={};return d.forEach(k=>{g[k]=e[k]}),g}var X=["data","status","isLoading","isSuccess","isError","error"];function ke({api:e,moduleOptions:{batch:d,hooks:{useDispatch:g,useSelector:k,useStore:q},unstable__sideEffectsInRender:h,createSelector:S},serializeQueryArgs:m,context:D}){const C=h?t=>t():n.useEffect;return{buildQueryHooks:A,buildInfiniteQueryHooks:K,buildMutationHook:W,usePrefetch:G};function j(t,r,l){if(r?.endpointName&&t.isUninitialized){const{endpointName:u}=r,a=D.endpointDefinitions[u];l!==Q.skipToken&&m({queryArgs:r.originalArgs,endpointDefinition:a,endpointName:u})===m({queryArgs:l,endpointDefinition:a,endpointName:u})&&(r=void 0)}let c=t.isSuccess?t.data:r?.data;c===void 0&&(c=t.data);const i=c!==void 0,s=t.isLoading,o=(!r||r.isLoading||r.isUninitialized)&&!i&&s,f=t.isSuccess||i&&(s&&!r?.isError||t.isUninitialized);return{...t,data:c,currentData:t.data,isFetching:s,isLoading:o,isSuccess:f}}function F(t,r,l){if(r?.endpointName&&t.isUninitialized){const{endpointName:u}=r,a=D.endpointDefinitions[u];l!==Q.skipToken&&m({queryArgs:r.originalArgs,endpointDefinition:a,endpointName:u})===m({queryArgs:l,endpointDefinition:a,endpointName:u})&&(r=void 0)}let c=t.isSuccess?t.data:r?.data;c===void 0&&(c=t.data);const i=c!==void 0,s=t.isLoading,o=(!r||r.isLoading||r.isUninitialized)&&!i&&s,f=t.isSuccess||s&&i;return{...t,data:c,currentData:t.data,isFetching:s,isLoading:o,isSuccess:f}}function G(t,r){const l=g(),c=$(r);return n.useCallback((i,s)=>l(e.util.prefetch(t,i,{...c,...s})),[t,l,c])}function M(t,r,{refetchOnReconnect:l,refetchOnFocus:c,refetchOnMountOrArgChange:i,skip:s=!1,pollingInterval:o=0,skipPollingIfUnfocused:f=!1,...u}={}){const{initiate:a}=e.endpoints[t],b=g(),O=n.useRef(void 0);if(!O.current){const L=b(e.internalActions.internal_getRTKQSubscriptions());if(process.env.NODE_ENV!=="production"&&(typeof L!="object"||typeof L?.type=="string"))throw new Error(process.env.NODE_ENV==="production"?x.formatProdErrorMessage(37):`Warning: Middleware for RTK-Query API at reducerPath "${e.reducerPath}" has not been added to the store.
    You must add the middleware for RTK-Query to function correctly!`);O.current=L}const p=Z(s?Q.skipToken:r),y=$({refetchOnReconnect:l,refetchOnFocus:c,pollingInterval:o,skipPollingIfUnfocused:f}),v=u.initialPageParam,E=$(v),P=n.useRef(void 0);let{queryCacheKey:I,requestId:U}=P.current||{},V=!1;I&&U&&(V=O.current.isRequestSubscribed(I,U));const N=!V&&P.current!==void 0;return C(()=>{N&&(P.current=void 0)},[N]),C(()=>{const L=P.current;if(typeof process<"u"&&process.env.NODE_ENV==="removeMeOnCompilation"&&console.log(N),p===Q.skipToken){L?.unsubscribe(),P.current=void 0;return}const se=P.current?.subscriptionOptions;if(!L||L.arg!==p){L?.unsubscribe();const oe=b(a(p,{subscriptionOptions:y,forceRefetch:i,...te(D.endpointDefinitions[t])?{initialPageParam:E}:{}}));P.current=oe}else y!==se&&L.updateSubscriptionOptions(y)},[b,a,i,p,y,N,E,t]),[P,b,a,y]}function _(t,r){return(c,{skip:i=!1,selectFromResult:s}={})=>{const{select:o}=e.endpoints[t],f=Z(i?Q.skipToken:c),u=n.useRef(void 0),a=n.useMemo(()=>S([o(f),(v,E)=>E,v=>f],r,{memoizeOptions:{resultEqualityCheck:T.shallowEqual}}),[o,f]),b=n.useMemo(()=>s?S([a],s,{devModeChecks:{identityFunctionCheck:"never"}}):a,[a,s]),O=k(v=>b(v,u.current),T.shallowEqual),p=q(),y=a(p.getState(),u.current);return me(()=>{u.current=y},[y]),O}}function w(t){n.useEffect(()=>()=>{t.current?.unsubscribe?.(),t.current=void 0},[t])}function R(t){if(!t.current)throw new Error(process.env.NODE_ENV==="production"?x.formatProdErrorMessage(38):"Cannot refetch a query that has not been started yet.");return t.current.refetch()}function A(t){const r=(i,s={})=>{const[o]=M(t,i,s);return w(o),n.useMemo(()=>({refetch:()=>R(o)}),[o])},l=({refetchOnReconnect:i,refetchOnFocus:s,pollingInterval:o=0,skipPollingIfUnfocused:f=!1}={})=>{const{initiate:u}=e.endpoints[t],a=g(),[b,O]=n.useState(Y),p=n.useRef(void 0),y=$({refetchOnReconnect:i,refetchOnFocus:s,pollingInterval:o,skipPollingIfUnfocused:f});C(()=>{const I=p.current?.subscriptionOptions;y!==I&&p.current?.updateSubscriptionOptions(y)},[y]);const v=n.useRef(y);C(()=>{v.current=y},[y]);const E=n.useCallback(function(I,U=!1){let V;return d(()=>{p.current?.unsubscribe(),p.current=V=a(u(I,{subscriptionOptions:v.current,forceRefetch:!U})),O(I)}),V},[a,u]),P=n.useCallback(()=>{p.current?.queryCacheKey&&a(e.internalActions.removeQueryResult({queryCacheKey:p.current?.queryCacheKey}))},[a]);return n.useEffect(()=>()=>{p?.current?.unsubscribe()},[]),n.useEffect(()=>{b!==Y&&!p.current&&E(b,!0)},[b,E]),n.useMemo(()=>[E,b,{reset:P}],[E,b,P])},c=_(t,j);return{useQueryState:c,useQuerySubscription:r,useLazyQuerySubscription:l,useLazyQuery(i){const[s,o,{reset:f}]=l(i),u=c(o,{...i,skip:o===Y}),a=n.useMemo(()=>({lastArg:o}),[o]);return n.useMemo(()=>[s,{...u,reset:f},a],[s,u,f,a])},useQuery(i,s){const o=r(i,s),f=c(i,{selectFromResult:i===Q.skipToken||s?.skip?void 0:ee,...s}),u=J(f,...X);return n.useDebugValue(u),n.useMemo(()=>({...f,...o}),[f,o])}}}function K(t){const r=(c,i={})=>{const[s,o,f,u]=M(t,c,i),a=n.useRef(u);C(()=>{a.current=u},[u]);const b=n.useCallback(function(y,v){let E;return d(()=>{s.current?.unsubscribe(),s.current=E=o(f(y,{subscriptionOptions:a.current,direction:v}))}),E},[s,o,f]);w(s);const O=Z(i.skip?Q.skipToken:c),p=n.useCallback(()=>R(s),[s]);return n.useMemo(()=>({trigger:b,refetch:p,fetchNextPage:()=>b(O,"forward"),fetchPreviousPage:()=>b(O,"backward")}),[p,b,O])},l=_(t,F);return{useInfiniteQueryState:l,useInfiniteQuerySubscription:r,useInfiniteQuery(c,i){const{refetch:s,fetchNextPage:o,fetchPreviousPage:f}=r(c,i),u=l(c,{selectFromResult:c===Q.skipToken||i?.skip?void 0:ee,...i}),a=J(u,...X,"hasNextPage","hasPreviousPage");return n.useDebugValue(a),n.useMemo(()=>({...u,fetchNextPage:o,fetchPreviousPage:f,refetch:s}),[u,o,f,s])}}}function W(t){return({selectFromResult:r,fixedCacheKey:l}={})=>{const{select:c,initiate:i}=e.endpoints[t],s=g(),[o,f]=n.useState();n.useEffect(()=>()=>{o?.arg.fixedCacheKey||o?.reset()},[o]);const u=n.useCallback(function(I){const U=s(i(I,{fixedCacheKey:l}));return f(U),U},[s,i,l]),{requestId:a}=o||{},b=n.useMemo(()=>c({fixedCacheKey:l,requestId:o?.requestId}),[l,o,c]),O=n.useMemo(()=>r?S([b],r):b,[r,b]),p=k(O,T.shallowEqual),y=l==null?o?.arg.originalArgs:void 0,v=n.useCallback(()=>{d(()=>{o&&f(void 0),l&&s(e.internalActions.removeMutationResult({requestId:a,fixedCacheKey:l}))})},[s,l,o,a]),E=J(p,...X,"endpointName");n.useDebugValue(E);const P=n.useMemo(()=>({...p,originalArgs:y,reset:v}),[p,y,v]);return n.useMemo(()=>[u,P],[u,P])}}}var Se=Symbol(),ve=({batch:e=T.batch,hooks:d={useDispatch:T.useDispatch,useSelector:T.useSelector,useStore:T.useStore},createSelector:g=Q.createSelector,unstable__sideEffectsInRender:k=!1,...q}={})=>{if(process.env.NODE_ENV!=="production"){const h=["useDispatch","useSelector","useStore"];let S=!1;for(const m of h)if(fe(q)>0&&(q[m]&&(S||(console.warn("As of RTK 2.0, the hooks now need to be specified as one object, provided under a `hooks` key:\n`reactHooksModule({ hooks: { useDispatch, useSelector, useStore } })`"),S=!0)),d[m]=q[m]),typeof d[m]!="function")throw new Error(process.env.NODE_ENV==="production"?x.formatProdErrorMessage(36):`When using custom hooks for context, all ${h.length} hooks need to be provided: ${h.join(", ")}.
Hook ${m} was either not provided or not a function.`)}return{name:Se,init(h,{serializeQueryArgs:S},m){const D=h,{buildQueryHooks:C,buildInfiniteQueryHooks:j,buildMutationHook:F,usePrefetch:G}=ke({api:h,moduleOptions:{batch:e,hooks:d,unstable__sideEffectsInRender:k,createSelector:g},serializeQueryArgs:S,context:m});return H(D,{usePrefetch:G}),H(m,{batch:e}),{injectEndpoint(M,_){if(de(_)){const{useQuery:w,useLazyQuery:R,useLazyQuerySubscription:A,useQueryState:K,useQuerySubscription:W}=C(M);H(D.endpoints[M],{useQuery:w,useLazyQuery:R,useLazyQuerySubscription:A,useQueryState:K,useQuerySubscription:W}),h[`use${z(M)}Query`]=w,h[`useLazy${z(M)}Query`]=R}if(le(_)){const w=F(M);H(D.endpoints[M],{useMutation:w}),h[`use${z(M)}Mutation`]=w}else if(te(_)){const{useInfiniteQuery:w,useInfiniteQuerySubscription:R,useInfiniteQueryState:A}=j(M);H(D.endpoints[M],{useInfiniteQuery:w,useInfiniteQuerySubscription:R,useInfiniteQueryState:A}),h[`use${z(M)}InfiniteQuery`]=w}}}}}},Ee=Q.buildCreateApi(Q.coreModule(),ve());const ne=["User","School","Class","AuthFactor"];function Pe({tagTypes:e=[]}={}){const d=Q.fetchBaseQuery({baseUrl:`${re.SERVICE_API_URL}/`,credentials:"include",prepareHeaders:(k,q)=>{const{type:h,arg:S}=q,m=typeof S=="string"?"GET":S.method||"GET";if(h==="mutation"||!ue.isSafeHttpMethod(m)){const D=B.getCsrfCookie();D&&k.set("x-csrftoken",D)}return k}}),g=Ee({baseQuery:async(k,q,h)=>{if(q.type==="mutation"&&B.getCsrfCookie()===void 0){const{error:S}=await d({url:"/csrf/cookie/",method:"GET"},q,{});S!==void 0&&console.error(S),B.getCsrfCookie()}return await d(k,q,h)},tagTypes:[...ne,...e],endpoints:()=>({})});return g.injectEndpoints({endpoints:k=>({logout:ie.buildLogoutEndpoint(g,k)})})}exports.schemas=ce.schemas;exports.urls=ae.urls;exports.createApi=Pe;exports.tagTypes=ne;
//# sourceMappingURL=index.cjs.js.map
