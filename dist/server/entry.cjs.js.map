{"version":3,"file":"entry.cjs.js","sources":["../../src/server/entry.tsx"],"sourcesContent":["/**\n * Â© Ocado Group\n * Created on 20/10/2025 at 17:45:17(+01:00).\n *\n * The client and server entrypoints when doing server-side rendering.\n *\n * Helpful links:\n * https://mui.com/material-ui/guides/server-rendering/\n * https://github.com/remix-run/react-router/tree/main/examples/ssr\n */\n\nimport { BrowserRouter, Routes, StaticRouter } from \"react-router\"\nimport { type FC, type ReactNode, StrictMode } from \"react\"\nimport createCache, {\n  type Options as CreateEmotionCacheOptions,\n} from \"@emotion/cache\"\n\nimport { type AppProps } from \"./App\"\nimport packageJson from \"../../package.json\"\n\n/**\n * Creates a new Emotion cache instance.\n */\nfunction createEmotionCache(\n  {\n    key = \"css\", // ensures all styles are generated with this prefix\n    prepend = true, // loads MUI-styles first so we can override them easily\n    ...otherOptions\n  } = {} as CreateEmotionCacheOptions,\n) {\n  return createCache({ key, prepend, ...otherOptions })\n}\n\nexport type EntryAppProps = Pick<AppProps, \"emotionCache\" | \"children\">\n\nexport type EntryKwArgs = {\n  App: FC<EntryAppProps>\n  routes: ReactNode\n  createEmotionCacheOptions?: CreateEmotionCacheOptions\n}\n\nexport async function server({\n  App,\n  routes,\n  createEmotionCacheOptions = {} as CreateEmotionCacheOptions,\n  ...appProps\n}: EntryKwArgs) {\n  const { default: createEmotionServer } = await import(\n    \"@emotion/server/create-instance\"\n  )\n  const { renderToString } = await import(\"react-dom/server\")\n  const { default: fs } = await import(\"node:fs/promises\")\n\n  const cflStyle = await fs.readFile(\n    `./node_modules/${packageJson.name}/dist/style.css`,\n    \"utf-8\",\n  )\n\n  function render(path: string) {\n    const emotionCache = createEmotionCache(createEmotionCacheOptions)\n    const emotionServer = createEmotionServer(emotionCache)\n\n    const html = renderToString(\n      <StrictMode>\n        <App emotionCache={emotionCache} {...appProps}>\n          <StaticRouter location={path}>\n            <Routes>{routes}</Routes>\n          </StaticRouter>\n        </App>\n      </StrictMode>,\n    )\n\n    const emotionChunks = emotionServer.extractCriticalToChunks(html)\n    const emotionCss = emotionServer.constructStyleTagsFromChunks(emotionChunks)\n\n    return {\n      html,\n      head: `${emotionCss}<style data-cfl>${cflStyle}</style>`,\n    }\n  }\n\n  return { render }\n}\n\nexport async function client({\n  App,\n  routes,\n  createEmotionCacheOptions = {} as CreateEmotionCacheOptions,\n  ...appProps\n}: EntryKwArgs) {\n  const reactDomClientModule = await import(\"react-dom/client\")\n\n  // Check for the .default property to handle CJS/ESM interop.\n  // 'hydrateRoot' will be on the module itself OR on the .default object.\n  const { hydrateRoot } = reactDomClientModule.default || reactDomClientModule\n\n  const emotionCache = createEmotionCache(createEmotionCacheOptions)\n\n  hydrateRoot(\n    document.getElementById(\"root\") as HTMLElement,\n    <StrictMode>\n      <App emotionCache={emotionCache} {...appProps}>\n        <BrowserRouter>\n          <Routes>{routes}</Routes>\n        </BrowserRouter>\n      </App>\n    </StrictMode>,\n  )\n}\n"],"names":["createEmotionCache","key","prepend","otherOptions","createCache","server","App","routes","createEmotionCacheOptions","appProps","createEmotionServer","renderToString","fs","cflStyle","packageJson","render","path","emotionCache","emotionServer","html","StrictMode","jsx","StaticRouter","Routes","emotionChunks","emotionCss","client","reactDomClientModule","hydrateRoot","BrowserRouter"],"mappings":"mxBAuBA,SAASA,EACP,CACE,IAAAC,EAAM,MACN,QAAAC,EAAU,GACV,GAAGC,CACL,EAAI,GACJ,CACA,OAAOC,EAAY,CAAE,IAAAH,EAAK,QAAAC,EAAS,GAAGC,EAAc,CACtD,CAUA,eAAsBE,EAAO,CAC3B,IAAAC,EACA,OAAAC,EACA,0BAAAC,EAA4B,CAAA,EAC5B,GAAGC,CACL,EAAgB,CACd,KAAM,CAAE,QAASC,GAAwB,KAAM,QAC7C,iCACF,EACM,CAAE,eAAAC,CAAA,EAAmB,KAAM,QAAO,kBAAkB,EACpD,CAAE,QAASC,GAAO,KAAM,QAAO,kBAAkB,EAEjDC,EAAW,MAAMD,EAAG,SACxB,kBAAkBE,EAAY,IAAI,kBAClC,OAAA,EAGF,SAASC,EAAOC,EAAc,CAC5B,MAAMC,EAAejB,EAAmBQ,CAAyB,EAC3DU,EAAgBR,EAAoBO,CAAY,EAEhDE,EAAOR,QACVS,EAAAA,WAAA,CACC,SAAAC,MAACf,EAAA,CAAI,aAAAW,EAA6B,GAAGR,EACnC,SAAAY,MAACC,EAAAA,aAAA,CAAa,SAAUN,EACtB,SAAAK,EAAAA,IAACE,EAAAA,OAAA,CAAQ,SAAAhB,CAAA,CAAO,EAClB,EACF,CAAA,CACF,CAAA,EAGIiB,EAAgBN,EAAc,wBAAwBC,CAAI,EAC1DM,EAAaP,EAAc,6BAA6BM,CAAa,EAE3E,MAAO,CACL,KAAAL,EACA,KAAM,GAAGM,CAAU,mBAAmBZ,CAAQ,UAAA,CAElD,CAEA,MAAO,CAAE,OAAAE,CAAA,CACX,CAEA,eAAsBW,EAAO,CAC3B,IAAApB,EACA,OAAAC,EACA,0BAAAC,EAA4B,CAAA,EAC5B,GAAGC,CACL,EAAgB,CACd,MAAMkB,EAAuB,KAAM,QAAO,kBAAkB,EAItD,CAAE,YAAAC,CAAA,EAAgBD,EAAqB,SAAWA,EAElDV,EAAejB,EAAmBQ,CAAyB,EAEjEoB,EACE,SAAS,eAAe,MAAM,EAC9BP,MAACD,EAAAA,WAAA,CACC,SAAAC,EAAAA,IAACf,EAAA,CAAI,aAAAW,EAA6B,GAAGR,EACnC,SAAAY,EAAAA,IAACQ,EAAAA,cAAA,CACC,SAAAR,EAAAA,IAACE,SAAA,CAAQ,SAAAhB,CAAA,CAAO,EAClB,EACF,CAAA,CACF,CAAA,CAEJ"}