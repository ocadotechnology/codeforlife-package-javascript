{"version":3,"file":"entry.cjs.js","sources":["../../src/server/entry.tsx"],"sourcesContent":["/**\n * Â© Ocado Group\n * Created on 20/10/2025 at 17:45:17(+01:00).\n *\n * The client and server entrypoints when doing server-side rendering.\n *\n * Helpful links:\n * https://mui.com/material-ui/guides/server-rendering/\n * https://github.com/remix-run/react-router/tree/main/examples/ssr\n */\n\nimport { BrowserRouter, Routes, StaticRouter } from \"react-router\"\nimport { type FC, type ReactNode, StrictMode } from \"react\"\nimport createCache, {\n  type Options as CreateEmotionCacheOptions,\n} from \"@emotion/cache\"\n\nimport { type AppProps } from \"./App\"\n\n/**\n * Creates a new Emotion cache instance.\n */\nfunction createEmotionCache(\n  {\n    key = \"css\", // ensures all styles are generated with this prefix\n    prepend = true, // loads MUI-styles first so we can override them easily\n    ...otherOptions\n  } = {} as CreateEmotionCacheOptions,\n) {\n  return createCache({ key, prepend, ...otherOptions })\n}\n\nexport type EntryAppProps = Pick<AppProps, \"emotionCache\" | \"children\">\n\nexport type EntryKwArgs = {\n  App: FC<EntryAppProps>\n  routes: ReactNode\n  createEmotionCacheOptions?: CreateEmotionCacheOptions\n}\n\nexport async function server({\n  App,\n  routes,\n  createEmotionCacheOptions = {} as CreateEmotionCacheOptions,\n  ...appProps\n}: EntryKwArgs) {\n  const { default: createEmotionServer } = await import(\n    \"@emotion/server/create-instance\"\n  )\n  const { renderToString } = await import(\"react-dom/server\")\n  const { default: cflStyle } = await import(\"codeforlife/style.css?inline\")\n\n  function render(path: string) {\n    const emotionCache = createEmotionCache(createEmotionCacheOptions)\n    const emotionServer = createEmotionServer(emotionCache)\n\n    const html = renderToString(\n      <StrictMode>\n        <App emotionCache={emotionCache} {...appProps}>\n          <StaticRouter location={path}>\n            <Routes>{routes}</Routes>\n          </StaticRouter>\n        </App>\n      </StrictMode>,\n    )\n\n    const emotionChunks = emotionServer.extractCriticalToChunks(html)\n    const emotionCss = emotionServer.constructStyleTagsFromChunks(emotionChunks)\n\n    return {\n      html,\n      head: `${emotionCss}<style data-cfl>${cflStyle}</style>`,\n    }\n  }\n\n  return { render }\n}\n\nexport async function client({\n  App,\n  routes,\n  createEmotionCacheOptions = {} as CreateEmotionCacheOptions,\n  ...appProps\n}: EntryKwArgs) {\n  const { hydrateRoot } = await import(\"react-dom/client\")\n\n  const emotionCache = createEmotionCache(createEmotionCacheOptions)\n\n  hydrateRoot(\n    document.getElementById(\"root\") as HTMLElement,\n    <StrictMode>\n      <App emotionCache={emotionCache} {...appProps}>\n        <BrowserRouter>\n          <Routes>{routes}</Routes>\n        </BrowserRouter>\n      </App>\n    </StrictMode>,\n  )\n}\n"],"names":["createEmotionCache","key","prepend","otherOptions","createCache","server","App","routes","createEmotionCacheOptions","appProps","createEmotionServer","renderToString","n","cflStyle","render","path","emotionCache","emotionServer","html","StrictMode","jsx","StaticRouter","Routes","emotionChunks","emotionCss","client","hydrateRoot","BrowserRouter"],"mappings":"iTAsBA,SAASA,EACP,CACE,IAAAC,EAAM,MACN,QAAAC,EAAU,GACV,GAAGC,CACL,EAAI,GACJ,CACA,OAAOC,EAAY,CAAE,IAAAH,EAAK,QAAAC,EAAS,GAAGC,EAAc,CACtD,CAUA,eAAsBE,EAAO,CAC3B,IAAAC,EACA,OAAAC,EACA,0BAAAC,EAA4B,CAAA,EAC5B,GAAGC,CACL,EAAgB,CACd,KAAM,CAAE,QAASC,GAAwB,MAAM,QAAA,QAAA,EAAA,KAAA,IAAA,QAC7C,4DACF,CAAA,EACM,CAAE,eAAAC,CAAA,EAAmB,MAAM,QAAA,QAAA,EAAA,KAAA,IAAA,QAAO,gCAAkB,CAAA,EAAA,KAAAC,GAAAA,EAAA,cAAA,EACpD,CAAE,QAASC,GAAa,MAAM,QAAA,QAAA,EAAA,KAAA,IAAA,QAAO,uBAA8B,CAAA,EAEzE,SAASC,EAAOC,EAAc,CAC5B,MAAMC,EAAehB,EAAmBQ,CAAyB,EAC3DS,EAAgBP,EAAoBM,CAAY,EAEhDE,EAAOP,0BACVQ,EAAAA,WAAA,CACC,SAAAC,wBAACd,EAAA,CAAI,aAAAU,EAA6B,GAAGP,EACnC,SAAAW,wBAACC,EAAAA,aAAA,CAAa,SAAUN,EACtB,SAAAK,EAAAA,kBAAAA,IAACE,EAAAA,OAAA,CAAQ,SAAAf,CAAA,CAAO,EAClB,EACF,CAAA,CACF,CAAA,EAGIgB,EAAgBN,EAAc,wBAAwBC,CAAI,EAC1DM,EAAaP,EAAc,6BAA6BM,CAAa,EAE3E,MAAO,CACL,KAAAL,EACA,KAAM,GAAGM,CAAU,mBAAmBX,CAAQ,UAAA,CAElD,CAEA,MAAO,CAAE,OAAAC,CAAA,CACX,CAEA,eAAsBW,EAAO,CAC3B,IAAAnB,EACA,OAAAC,EACA,0BAAAC,EAA4B,CAAA,EAC5B,GAAGC,CACL,EAAgB,CACd,KAAM,CAAE,YAAAiB,CAAA,EAAgB,MAAM,QAAA,QAAA,EAAA,KAAA,IAAA,QAAO,wBAAkB,CAAA,EAAA,KAAAd,GAAAA,EAAA,MAAA,EAEjDI,EAAehB,EAAmBQ,CAAyB,EAEjEkB,EACE,SAAS,eAAe,MAAM,EAC9BN,wBAACD,EAAAA,WAAA,CACC,SAAAC,EAAAA,kBAAAA,IAACd,EAAA,CAAI,aAAAU,EAA6B,GAAGP,EACnC,SAAAW,EAAAA,kBAAAA,IAACO,EAAAA,cAAA,CACC,SAAAP,EAAAA,kBAAAA,IAACE,SAAA,CAAQ,SAAAf,CAAA,CAAO,EAClB,EACF,CAAA,CACF,CAAA,CAEJ"}