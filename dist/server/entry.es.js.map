{"version":3,"file":"entry.es.js","sources":["../../src/server/entry.tsx"],"sourcesContent":["/**\n * Â© Ocado Group\n * Created on 20/10/2025 at 17:45:17(+01:00).\n *\n * The client and server entrypoints when doing server-side rendering.\n *\n * Helpful links:\n * https://mui.com/material-ui/guides/server-rendering/\n * https://github.com/remix-run/react-router/tree/main/examples/ssr\n */\n\nimport { BrowserRouter, Routes, StaticRouter } from \"react-router\"\nimport { type FC, type ReactNode, StrictMode } from \"react\"\nimport createCache, {\n  type Options as CreateEmotionCacheOptions,\n} from \"@emotion/cache\"\n\nimport { type AppProps } from \"./App\"\n\n/**\n * Creates a new Emotion cache instance.\n */\nfunction createEmotionCache(\n  {\n    key = \"css\", // ensures all styles are generated with this prefix\n    prepend = true, // loads MUI-styles first so we can override them easily\n    ...otherOptions\n  } = {} as CreateEmotionCacheOptions,\n) {\n  return createCache({ key, prepend, ...otherOptions })\n}\n\nexport type EntryAppProps = Pick<AppProps, \"emotionCache\" | \"children\">\n\nexport type EntryKwArgs = {\n  App: FC<EntryAppProps>\n  routes: ReactNode\n  createEmotionCacheOptions?: CreateEmotionCacheOptions\n}\n\nexport async function server({\n  App,\n  routes,\n  createEmotionCacheOptions = {} as CreateEmotionCacheOptions,\n  ...appProps\n}: EntryKwArgs) {\n  const { default: createEmotionServer } = await import(\n    \"@emotion/server/create-instance\"\n  )\n  const { renderToString } = await import(\"react-dom/server\")\n  const { default: cflStyle } = await import(\"codeforlife/style.css?inline\")\n\n  function render(path: string) {\n    const emotionCache = createEmotionCache(createEmotionCacheOptions)\n    const emotionServer = createEmotionServer(emotionCache)\n\n    const html = renderToString(\n      <StrictMode>\n        <App emotionCache={emotionCache} {...appProps}>\n          <StaticRouter location={path}>\n            <Routes>{routes}</Routes>\n          </StaticRouter>\n        </App>\n      </StrictMode>,\n    )\n\n    const emotionChunks = emotionServer.extractCriticalToChunks(html)\n    const emotionCss = emotionServer.constructStyleTagsFromChunks(emotionChunks)\n\n    return {\n      html,\n      head: `${emotionCss}<style data-cfl>${cflStyle}</style>`,\n    }\n  }\n\n  return { render }\n}\n\nexport async function client({\n  App,\n  routes,\n  createEmotionCacheOptions = {} as CreateEmotionCacheOptions,\n  ...appProps\n}: EntryKwArgs) {\n  const { hydrateRoot } = await import(\"react-dom/client\")\n\n  const emotionCache = createEmotionCache(createEmotionCacheOptions)\n\n  hydrateRoot(\n    document.getElementById(\"root\") as HTMLElement,\n    <StrictMode>\n      <App emotionCache={emotionCache} {...appProps}>\n        <BrowserRouter>\n          <Routes>{routes}</Routes>\n        </BrowserRouter>\n      </App>\n    </StrictMode>,\n  )\n}\n"],"names":["createEmotionCache","key","prepend","otherOptions","createCache","server","App","routes","createEmotionCacheOptions","appProps","createEmotionServer","renderToString","cflStyle","render","path","emotionCache","emotionServer","html","StrictMode","jsx","StaticRouter","Routes","emotionChunks","emotionCss","client","hydrateRoot","BrowserRouter"],"mappings":";;;;;;;;AAsBA,SAASA,EACP;AAAA,EACE,KAAAC,IAAM;AAAA;AAAA,EACN,SAAAC,IAAU;AAAA;AAAA,EACV,GAAGC;AACL,IAAI,IACJ;AACA,SAAOC,EAAY,EAAE,KAAAH,GAAK,SAAAC,GAAS,GAAGC,GAAc;AACtD;AAUA,eAAsBE,EAAO;AAAA,EAC3B,KAAAC;AAAA,EACA,QAAAC;AAAA,EACA,2BAAAC,IAA4B,CAAA;AAAA,EAC5B,GAAGC;AACL,GAAgB;AACd,QAAM,EAAE,SAASC,MAAwB,MAAM,OAC7C,iCACF,GACM,EAAE,gBAAAC,EAAA,IAAmB,MAAM,OAAO,kBAAkB,GACpD,EAAE,SAASC,MAAa,MAAM,OAAO,8BAA8B;AAEzE,WAASC,EAAOC,GAAc;AAC5B,UAAMC,IAAef,EAAmBQ,CAAyB,GAC3DQ,IAAgBN,EAAoBK,CAAY,GAEhDE,IAAON;AAAA,wBACVO,GAAA,EACC,UAAA,gBAAAC,EAACb,GAAA,EAAI,cAAAS,GAA6B,GAAGN,GACnC,UAAA,gBAAAU,EAACC,GAAA,EAAa,UAAUN,GACtB,UAAA,gBAAAK,EAACE,GAAA,EAAQ,UAAAd,EAAA,CAAO,GAClB,GACF,EAAA,CACF;AAAA,IAAA,GAGIe,IAAgBN,EAAc,wBAAwBC,CAAI,GAC1DM,IAAaP,EAAc,6BAA6BM,CAAa;AAE3E,WAAO;AAAA,MACL,MAAAL;AAAA,MACA,MAAM,GAAGM,CAAU,mBAAmBX,CAAQ;AAAA,IAAA;AAAA,EAElD;AAEA,SAAO,EAAE,QAAAC,EAAA;AACX;AAEA,eAAsBW,EAAO;AAAA,EAC3B,KAAAlB;AAAA,EACA,QAAAC;AAAA,EACA,2BAAAC,IAA4B,CAAA;AAAA,EAC5B,GAAGC;AACL,GAAgB;AACd,QAAM,EAAE,aAAAgB,EAAA,IAAgB,MAAM,OAAO,kBAAkB,GAEjDV,IAAef,EAAmBQ,CAAyB;AAEjE,EAAAiB;AAAA,IACE,SAAS,eAAe,MAAM;AAAA,IAC9B,gBAAAN,EAACD,GAAA,EACC,UAAA,gBAAAC,EAACb,GAAA,EAAI,cAAAS,GAA6B,GAAGN,GACnC,UAAA,gBAAAU,EAACO,GAAA,EACC,UAAA,gBAAAP,EAACE,GAAA,EAAQ,UAAAd,EAAA,CAAO,GAClB,GACF,EAAA,CACF;AAAA,EAAA;AAEJ;"}