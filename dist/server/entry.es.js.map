{"version":3,"file":"entry.es.js","sources":["../../src/server/entry.tsx"],"sourcesContent":["/**\n * Â© Ocado Group\n * Created on 20/10/2025 at 17:45:17(+01:00).\n *\n * The client and server entrypoints when doing server-side rendering.\n *\n * Helpful links:\n * https://mui.com/material-ui/guides/server-rendering/\n * https://github.com/remix-run/react-router/tree/main/examples/ssr\n */\n\nimport { BrowserRouter, StaticRouter } from \"react-router\"\nimport { type FC, StrictMode } from \"react\"\nimport createCache, {\n  type Options as CreateEmotionCacheOptions,\n} from \"@emotion/cache\"\n\nimport DefaultRoutes, { type DefaultRoutesProps } from \"./DefaultRoutes\"\nimport { type AppProps } from \"./App\"\nimport packageJson from \"../../package.json\"\n\n/**\n * Creates a new Emotion cache instance.\n */\nfunction createEmotionCache(\n  {\n    key = \"css\", // ensures all styles are generated with this prefix\n    prepend = true, // loads MUI-styles first so we can override them easily\n    ...otherOptions\n  } = {} as CreateEmotionCacheOptions,\n) {\n  return createCache({ key, prepend, ...otherOptions })\n}\n\nexport type EntryAppProps = Pick<AppProps, \"emotionCache\" | \"children\">\n\nexport type EntryKwArgs = {\n  App: FC<EntryAppProps>\n  routes: DefaultRoutesProps[\"children\"]\n  catchAllRoute?: DefaultRoutesProps[\"catchAll\"]\n  createEmotionCacheOptions?: CreateEmotionCacheOptions\n}\n\nconst DEFAULT_CATCH_ALL: DefaultRoutesProps[\"catchAll\"] = true\n\nexport async function server({\n  App,\n  routes,\n  catchAllRoute = DEFAULT_CATCH_ALL,\n  createEmotionCacheOptions,\n  ...appProps\n}: EntryKwArgs) {\n  const { default: createEmotionServer } = await import(\n    \"@emotion/server/create-instance\"\n  )\n  const { renderToString } = await import(\"react-dom/server\")\n  const { default: fs } = await import(\"node:fs/promises\")\n\n  const cflStyle = await fs.readFile(\n    `./node_modules/${packageJson.name}/dist/style.css`,\n    \"utf-8\",\n  )\n\n  function render(path: string) {\n    const emotionCache = createEmotionCache(createEmotionCacheOptions)\n    const emotionServer = createEmotionServer(emotionCache)\n\n    const html = renderToString(\n      <StrictMode>\n        <App emotionCache={emotionCache} {...appProps}>\n          <StaticRouter location={path}>\n            <DefaultRoutes catchAll={catchAllRoute}>{routes}</DefaultRoutes>\n          </StaticRouter>\n        </App>\n      </StrictMode>,\n    )\n\n    const emotionChunks = emotionServer.extractCriticalToChunks(html)\n    const emotionCss = emotionServer.constructStyleTagsFromChunks(emotionChunks)\n\n    return {\n      html,\n      head: `${emotionCss}<style data-cfl>${cflStyle}</style>`,\n    }\n  }\n\n  return { render }\n}\n\nexport async function client({\n  App,\n  routes,\n  catchAllRoute = DEFAULT_CATCH_ALL,\n  createEmotionCacheOptions,\n  ...appProps\n}: EntryKwArgs) {\n  const reactDomClientModule = await import(\"react-dom/client\")\n\n  // Check for the .default property to handle CJS/ESM interop.\n  // 'hydrateRoot' will be on the module itself OR on the .default object.\n  const { hydrateRoot } = reactDomClientModule.default || reactDomClientModule\n\n  const emotionCache = createEmotionCache(createEmotionCacheOptions)\n\n  hydrateRoot(\n    document.getElementById(\"root\") as HTMLElement,\n    <StrictMode>\n      <App emotionCache={emotionCache} {...appProps}>\n        <BrowserRouter>\n          <DefaultRoutes catchAll={catchAllRoute}>{routes}</DefaultRoutes>\n        </BrowserRouter>\n      </App>\n    </StrictMode>,\n  )\n}\n"],"names":["createEmotionCache","key","prepend","otherOptions","createCache","DEFAULT_CATCH_ALL","server","App","routes","catchAllRoute","createEmotionCacheOptions","appProps","createEmotionServer","renderToString","fs","cflStyle","packageJson","render","path","emotionCache","emotionServer","html","StrictMode","jsx","StaticRouter","DefaultRoutes","emotionChunks","emotionCss","client","reactDomClientModule","hydrateRoot","BrowserRouter"],"mappings":";;;;;;;;;;;;AAwBA,SAASA,EACP;AAAA,EACE,KAAAC,IAAM;AAAA;AAAA,EACN,SAAAC,IAAU;AAAA;AAAA,EACV,GAAGC;AACL,IAAI,IACJ;AACA,SAAOC,EAAY,EAAE,KAAAH,GAAK,SAAAC,GAAS,GAAGC,GAAc;AACtD;AAWA,MAAME,IAAoD;AAE1D,eAAsBC,EAAO;AAAA,EAC3B,KAAAC;AAAA,EACA,QAAAC;AAAA,EACA,eAAAC,IAAgBJ;AAAA,EAChB,2BAAAK;AAAA,EACA,GAAGC;AACL,GAAgB;AACd,QAAM,EAAE,SAASC,MAAwB,MAAM,OAC7C,iCACF,GACM,EAAE,gBAAAC,EAAA,IAAmB,MAAM,OAAO,kBAAkB,GACpD,EAAE,SAASC,MAAO,MAAM,OAAO,kBAAkB,GAEjDC,IAAW,MAAMD,EAAG;AAAA,IACxB,kBAAkBE,EAAY,IAAI;AAAA,IAClC;AAAA,EAAA;AAGF,WAASC,EAAOC,GAAc;AAC5B,UAAMC,IAAenB,EAAmBU,CAAyB,GAC3DU,IAAgBR,EAAoBO,CAAY,GAEhDE,IAAOR;AAAA,wBACVS,GAAA,EACC,UAAA,gBAAAC,EAAChB,KAAI,cAAAY,GAA6B,GAAGR,GACnC,UAAA,gBAAAY,EAACC,GAAA,EAAa,UAAUN,GACtB,4BAACO,GAAA,EAAc,UAAUhB,GAAgB,UAAAD,EAAA,CAAO,EAAA,CAClD,GACF,EAAA,CACF;AAAA,IAAA,GAGIkB,IAAgBN,EAAc,wBAAwBC,CAAI,GAC1DM,IAAaP,EAAc,6BAA6BM,CAAa;AAE3E,WAAO;AAAA,MACL,MAAAL;AAAA,MACA,MAAM,GAAGM,CAAU,mBAAmBZ,CAAQ;AAAA,IAAA;AAAA,EAElD;AAEA,SAAO,EAAE,QAAAE,EAAA;AACX;AAEA,eAAsBW,EAAO;AAAA,EAC3B,KAAArB;AAAA,EACA,QAAAC;AAAA,EACA,eAAAC,IAAgBJ;AAAA,EAChB,2BAAAK;AAAA,EACA,GAAGC;AACL,GAAgB;AACd,QAAMkB,IAAuB,MAAM,OAAO,kBAAkB,GAItD,EAAE,aAAAC,EAAA,IAAgBD,EAAqB,WAAWA,GAElDV,IAAenB,EAAmBU,CAAyB;AAEjE,EAAAoB;AAAA,IACE,SAAS,eAAe,MAAM;AAAA,sBAC7BR,GAAA,EACC,UAAA,gBAAAC,EAAChB,GAAA,EAAI,cAAAY,GAA6B,GAAGR,GACnC,UAAA,gBAAAY,EAACQ,GAAA,EACC,UAAA,gBAAAR,EAACE,KAAc,UAAUhB,GAAgB,UAAAD,EAAA,CAAO,GAClD,GACF,EAAA,CACF;AAAA,EAAA;AAEJ;"}